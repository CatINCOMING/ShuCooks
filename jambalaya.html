<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jambalaya Recipe - ShuCooks</title>
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="images/favicon-64.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon-180.png">
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <!-- External CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <a href="index.html">ShuCooks</a>
    <a href="index.html">Home</a>
    <a href="recipes.html">Recipes</a>
    <a href="contact.html">Contact</a>
</nav>

<section class="content">
    <h1>Jambalaya (CPK-Style)</h1>
    <img src="images/mmexport.jpg" class="recipe-photo" alt="Jambalaya">
    
    <div class="button-row">
        <button onclick="printRecipe()">ğŸ–¨ï¸ Print Recipe</button>
        <button id="chefBtn" onclick="toggleChefMode()">ğŸ‘¨â€ğŸ³ Chef Mode</button>
    </div>
    
    <h2>Ingredients (Serves 4)</h2>
    <div id="ingredientsList">
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>3 tbsp Cajun spice</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>12â€“16 shrimp, deveined</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>Â½ red bell pepper, diced</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>1 jalapeÃ±o, diced</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>Â½ red onion, diced</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>Â½ lb cooked linguine</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>1 andouille sausage, sliced</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>1 Â½ cups chicken stock</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>1 tbsp tomato sauce</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>Â½ tsp salt</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>Â¼ tsp black pepper</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>3 cloves garlic, minced</span>
        </div>
        <div class="ingredient-item" onclick="toggleIngredient(this)">
            <input type="checkbox">
            <span>3 tbsp cooking oil</span>
        </div>
    </div>
    
    <h2>Instructions</h2>
    <ol id="instructionsList">
        <li><strong>Season the vegetables:</strong> Mix peppers, onion, garlic, Cajun seasoning, and pepper.</li>
        <li><strong>Sear the shrimp:</strong> Cook 30â€“60 seconds per side.</li>
        <li><strong>Cook the sausage:</strong> SautÃ© 1 minute.</li>
        <li><strong>Cook the vegetables:</strong> Sear 3â€“4 minutes.</li>
        <li><strong>Build the sauce:</strong> Add stock + tomato sauce, simmer 5 minutes.</li>
        <li><strong>Add pasta:</strong> Toss 2â€“3 minutes until coated.</li>
    </ol>
</section>

<!-- Chef Mode -->
<div id="chefModeContainer" class="chef-mode-container">
    <div class="chef-mode-header">
        <h2>
            <span>ğŸ‘¨â€ğŸ³ Chef Mode</span>
            <span class="hands-free-badge">ğŸ”“ Screen Unlocked</span>
            <span id="voiceStatus" onclick="retryVoice()">ğŸ¤ Starting...</span>
        </h2>
        <button class="exit-chef-mode" onclick="toggleChefMode()">âœ• Exit</button>
    </div>
    
    <div class="chef-mode-content">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Step 1 of 6</div>
        
        <div class="ingredients-toggle" onclick="toggleIngredientsView()">
            <strong>ğŸ“‹ Ingredients Checklist</strong>
            <span id="ingredientsToggleIcon">â–¼</span>
        </div>
        <div class="ingredients-list" id="chefIngredientsList" style="display: none;">
            <div id="chefIngredientsContent"></div>
        </div>
        
        <div class="current-step" id="currentStep" onclick="nextStep()">
            <div class="step-title" id="stepTitle">Step 1: Season the vegetables</div>
            <div class="step-text" id="stepText">Mix peppers, onion, garlic, Cajun seasoning, and pepper.</div>
            
            <div class="timer-section" id="timerSection" style="display: none;">
                <div class="timer-display" id="timerDisplay">00:00</div>
                <div class="timer-buttons">
                    <button onclick="startTimer(60)">1 min</button>
                    <button onclick="startTimer(180)">3 min</button>
                    <button onclick="startTimer(300)">5 min</button>
                    <button onclick="pauseTimer()">â¸ Pause</button>
                    <button onclick="resetTimer()">ğŸ”„ Reset</button>
                </div>
            </div>
        </div>
        
        <div class="chef-navigation">
            <button onclick="prevStep()" id="prevBtn">â¬…ï¸ Previous</button>
            <button onclick="nextStep()" id="nextBtn">Next â¡ï¸</button>
        </div>
        
        <div class="all-steps-preview">
            <h3>All Steps</h3>
            <div id="stepsPreview"></div>
        </div>
        
        <div class="commands-help">
            <h3>ğŸ¤ Voice Commands Reference</h3>
            
            <div style="background: rgba(10, 92, 10, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #8fd694;">
                <h4 style="color: #8fd694; margin-bottom: 10px;">âœ… CONFIRMED WORKING:</h4>
                <ul style="color: #8fd694; list-style: none; padding: 0;">
                    <li style="padding: 5px 0;"><code>"next"</code> / <code>"continue"</code> - Next step</li>
                    <li style="padding: 5px 0;"><code>"back"</code> / <code>"previous"</code> - Previous step</li>
                    <li style="padding: 5px 0;"><code>"go to step 3"</code> - Jump to step</li>
                    <li style="padding: 5px 0;"><code>"repeat"</code> - Repeat current step</li>
                    <li style="padding: 5px 0;"><code>"start timer"</code> - Start timer</li>
                    <li style="padding: 5px 0;"><code>"show ingredients"</code> - Show list</li>
                    <li style="padding: 5px 0;"><code>"hide ingredients"</code> - Hide list</li>
                </ul>
            </div>
            
            <div style="background: rgba(92, 74, 10, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc988;">
                <h4 style="color: #ffc988; margin-bottom: 10px;">âš ï¸ MIGHT WORK (Test These):</h4>
                <ul style="color: #ffc988; list-style: none; padding: 0;">
                    <li style="padding: 5px 0;"><code>"what are the first 2 ingredients"</code></li>
                    <li style="padding: 5px 0;"><code>"check off ingredient 2"</code></li>
                    <li style="padding: 5px 0;"><code>"check off the shrimp"</code></li>
                    <li style="padding: 5px 0;"><code>"jump to step five"</code></li>
                </ul>
            </div>
            
            <div style="background: rgba(74, 10, 10, 0.3); padding: 15px; border-radius: 8px; border-left: 4px solid #ff6b6b;">
                <h4 style="color: #ff6b6b; margin-bottom: 10px;">âŒ NOT WORKING YET:</h4>
                <ul style="color: #ff6b6b; list-style: none; padding: 0;">
                    <li style="padding: 5px 0;">Complex multi-part commands</li>
                    <li style="padding: 5px 0;">Questions about recipe details</li>
                    <li style="padding: 5px 0;">Custom timer durations</li>
                    <li style="padding: 5px 0;">Temperature conversions</li>
                </ul>
            </div>
            
            <p style="color: #8fd694; margin-top: 16px; font-size: 14px;">
                ğŸ’¡ <strong>Pro Tip:</strong> Speak clearly and use simple commands. If something doesn't work, try a simpler version from the green list!
            </p>
            
            <button onclick="showFullCommandModal()" style="margin-top: 15px; width: 100%; background: linear-gradient(135deg, #8fd694, #7ac682); color: white; font-weight: bold; padding: 14px; border-radius: 12px; border: none; cursor: pointer;">
                ğŸ“‹ Open Full Command Reference
            </button>
        </div>
    </div>
</div>

<div class="voice-indicator" id="voiceIndicator">ğŸ¤ Listening...</div>

<!-- Full Command Reference Modal -->
<div id="fullCommandModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; overflow-y: auto; padding: 20px;">
    <div style="max-width: 900px; margin: 0 auto; background: #1a1a1a; border-radius: 16px; padding: 40px; color: white;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 style="color: #8fd694; margin: 0; font-size: 28px;">ğŸ¤ Complete Voice Commands Guide</h2>
            <button onclick="closeFullCommandModal()" style="background: #ff4444; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">âœ• Close</button>
        </div>
        
        <div style="background: rgba(10, 92, 10, 0.3); padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid #8fd694;">
            <h3 style="color: #8fd694; margin-bottom: 20px; font-size: 22px;">âœ… CONFIRMED WORKING COMMANDS</h3>
            <p style="color: #ccc; margin-bottom: 20px;">These commands have been tested and work reliably:</p>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #8fd694; margin-bottom: 12px; font-size: 18px;">Navigation Commands:</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ¯ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"next"</code> - Go to next step</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ¯ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"continue"</code> - Go to next step</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ¯ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"back"</code> - Go to previous step</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ¯ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"previous"</code> - Go to previous step</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ¯ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"go to step 3"</code> - Jump to step 3</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ¯ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"repeat"</code> - Read current step again</li>
                </ul>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #8fd694; margin-bottom: 12px; font-size: 18px;">Timer Commands:</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">â±ï¸ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"start timer"</code> - Start the timer</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">â±ï¸ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"set a timer"</code> - Start the timer</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">â±ï¸ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"begin timer"</code> - Start the timer</li>
                </ul>
            </div>
            
            <div>
                <h4 style="color: #8fd694; margin-bottom: 12px; font-size: 18px;">Ingredient Commands:</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ“‹ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"show ingredients"</code> - Display list</li>
                    <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ“‹ <code style="color: #8fd694; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"hide ingredients"</code> - Hide list</li>
                </ul>
            </div>
        </div>
        
        <div style="background: rgba(92, 74, 10, 0.3); padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid #ffc988;">
            <h3 style="color: #ffc988; margin-bottom: 20px; font-size: 22px;">âš ï¸ EXPERIMENTAL - MIGHT WORK</h3>
            <p style="color: #ccc; margin-bottom: 20px;">These commands use pattern matching and may work depending on pronunciation:</p>
            
            <ul style="list-style: none; padding: 0;">
                <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ”¶ <code style="color: #ffc988; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"what are the first 2 ingredients"</code></li>
                <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ”¶ <code style="color: #ffc988; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"tell me the first three ingredients"</code></li>
                <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ”¶ <code style="color: #ffc988; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"check off ingredient 2"</code></li>
                <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ”¶ <code style="color: #ffc988; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"check off the shrimp"</code></li>
                <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ”¶ <code style="color: #ffc988; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"mark the bell pepper"</code></li>
                <li style="padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 8px; border-radius: 6px;">ğŸ”¶ <code style="color: #ffc988; background: #0a0a0a; padding: 4px 8px; border-radius: 4px;">"jump to step five"</code></li>
            </ul>
        </div>
        
        <div style="background: rgba(74, 10, 10, 0.3); padding: 25px; border-radius: 12px; border-left: 5px solid #ff6b6b;">
            <h3 style="color: #ff6b6b; margin-bottom: 20px; font-size: 22px;">âŒ NOT YET IMPLEMENTED</h3>
            <p style="color: #ccc; margin-bottom: 20px;">These features are not currently available:</p>
            <ul style="list-style: none; padding: 0; color: #ff6b6b;">
                <li style="padding: 8px 0;">âŒ Complex multi-part commands ("go to step 3 and start timer")</li>
                <li style="padding: 8px 0;">âŒ Recipe questions ("how much salt do I need?")</li>
                <li style="padding: 8px 0;">âŒ Custom timer durations ("set timer for 2 minutes")</li>
                <li style="padding: 8px 0;">âŒ Conversions ("convert 1 cup to milliliters")</li>
                <li style="padding: 8px 0;">âŒ Ingredient substitutions</li>
            </ul>
        </div>
        
        <div style="background: rgba(42, 42, 42, 0.8); padding: 25px; border-radius: 12px; margin-top: 20px;">
            <h3 style="color: #8fd694; margin-bottom: 15px; font-size: 20px;">ğŸ’¡ Tips for Success:</h3>
            <ul style="color: #ccc; line-height: 1.9; padding-left: 20px;">
                <li>âœ… Speak clearly at normal pace</li>
                <li>âœ… Use simple, direct commands</li>
                <li>âœ… Wait for voice indicator before speaking</li>
                <li>âœ… If command fails, try simpler version from green list</li>
                <li>âœ… Check browser console (F12) to see what was heard</li>
                <li>âœ… Works best in Chrome or Edge</li>
            </ul>
        </div>
        
        <button onclick="closeFullCommandModal()" style="margin-top: 25px; width: 100%; background: linear-gradient(135deg, #8fd694, #7ac682); color: white; border: none; padding: 16px; border-radius: 12px; cursor: pointer; font-size: 18px; font-weight: bold;">
            âœ“ Got It - Close Reference
        </button>
    </div>
</div>

<script>
const steps = [
    { title: "Season the vegetables", text: "Mix peppers, onion, garlic, Cajun seasoning, and pepper.", timer: null },
    { title: "Sear the shrimp", text: "Cook 30â€“60 seconds per side.", timer: 45 },
    { title: "Cook the sausage", text: "SautÃ© 1 minute.", timer: 60 },
    { title: "Cook the vegetables", text: "Sear 3â€“4 minutes.", timer: 210 },
    { title: "Build the sauce", text: "Add stock + tomato sauce, simmer 5 minutes.", timer: 300 },
    { title: "Add pasta", text: "Toss 2â€“3 minutes until coated.", timer: 150 }
];

let currentStepIndex = 0, chefMode = false, wakeLock = null, timerInterval = null;
let timerSeconds = 0, timerRunning = false, recognition = null, ingredientsVisible = false;
let videoWakeLock = null, recognitionActive = false;

function enableVideoWakeLock() {
    if (videoWakeLock) return;
    videoWakeLock = document.createElement('video');
    videoWakeLock.loop = true;
    videoWakeLock.muted = true;
    videoWakeLock.playsInline = true;
    videoWakeLock.style.cssText = 'position:fixed;opacity:0;pointer-events:none;width:1px;height:1px';
    const c = document.createElement('canvas');
    c.width = c.height = 1;
    c.getContext('2d').fillRect(0,0,1,1);
    c.toBlob(b => {
        videoWakeLock.src = URL.createObjectURL(b);
        videoWakeLock.play().catch(()=>{});
    });
    document.body.appendChild(videoWakeLock);
}

function disableVideoWakeLock() {
    if (videoWakeLock) {
        videoWakeLock.pause();
        videoWakeLock.remove();
        videoWakeLock = null;
    }
}

function processVoiceCommand(transcript) {
    const text = transcript.toLowerCase().trim();
    console.log('Processing:', text);
    
    if (/\b(next|continue|forward)\b/.test(text)) {
        nextStep();
        speak("Next step");
        return;
    }
    if (/\b(back|previous)\b/.test(text)) {
        prevStep();
        speak("Going back");
        return;
    }
    if (/\brepeat\b/.test(text)) {
        speakCurrentStep();
        return;
    }
    
    const stepMatch = text.match(/\bstep\s*(\d+|one|two|three|four|five|six)\b/);
    if (stepMatch) {
        const nums = {one:1,two:2,three:3,four:4,five:5,six:6};
        const num = isNaN(stepMatch[1]) ? nums[stepMatch[1]] : parseInt(stepMatch[1]);
        if (num >= 1 && num <= 6) {
            currentStepIndex = num - 1;
            updateChefMode();
            speakCurrentStep();
            return;
        }
    }
    
    if (/\b(start|set|begin)\s*(timer|clock)\b/.test(text)) {
        const step = steps[currentStepIndex];
        if (step.timer) {
            startTimer(step.timer);
            speak(`Starting timer for ${Math.floor(step.timer/60)} minutes`);
        } else {
            speak("No timer for this step");
        }
        return;
    }
    
    if (/\bshow\s*(ingredient|ingredients)\b/.test(text)) {
        if (!ingredientsVisible) toggleIngredientsView();
        speak("Showing ingredients");
        return;
    }
    if (/\bhide\s*(ingredient|ingredients)\b/.test(text)) {
        if (ingredientsVisible) toggleIngredientsView();
        speak("Hiding ingredients");
        return;
    }
    
    speak("I didn't understand that");
    showVoiceIndicator("Command not recognized");
}

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = 'en-US';
    
    recognition.onstart = () => {
        recognitionActive = true;
        document.getElementById('voiceStatus').textContent = 'ğŸ¤ Listening';
        document.getElementById('voiceStatus').style.background = '#8fd694';
    };
    
    recognition.onerror = (e) => {
        recognitionActive = false;
        if (e.error === 'no-speech' || e.error === 'aborted' || e.error === 'audio-capture') return;
        document.getElementById('voiceStatus').textContent = 'ğŸ¤ Click to Retry';
        document.getElementById('voiceStatus').style.background = '#ff4444';
    };
    
    recognition.onend = () => {
        recognitionActive = false;
        if (chefMode && !recognitionActive) {
            setTimeout(() => {
                if (chefMode && !recognitionActive) {
                    try { recognition.start(); } catch(e) {}
                }
            }, 1000);
        }
    };
    
    recognition.onresult = (e) => {
        const transcript = e.results[e.results.length-1][0].transcript.trim();
        console.log('Heard:', transcript);
        showVoiceIndicator(`"${transcript}"`);
        processVoiceCommand(transcript);
    };
}

function showVoiceIndicator(t) {
    const el = document.getElementById('voiceIndicator');
    el.textContent = t || 'ğŸ¤ Listening...';
    el.classList.add('active');
    setTimeout(() => el.classList.remove('active'), 3000);
}

function toggleIngredient(el) {
    const cb = el.querySelector('input[type="checkbox"]');
    cb.checked = !cb.checked;
    el.classList.toggle('checked');
    updateChefIngredients();
}

function toggleChefIngredient(el) {
    const cb = el.querySelector('input[type="checkbox"]');
    const idx = parseInt(el.dataset.index, 10);
    cb.checked = !cb.checked;
    el.classList.toggle('checked');
    const main = document.querySelectorAll('#ingredientsList .ingredient-item')[idx];
    if (main) {
        main.querySelector('input').checked = cb.checked;
        main.classList.toggle('checked', cb.checked);
    }
}

function toggleIngredientsView() {
    ingredientsVisible = !ingredientsVisible;
    const list = document.getElementById('chefIngredientsList');
    const icon = document.getElementById('ingredientsToggleIcon');
    list.style.display = ingredientsVisible ? 'block' : 'none';
    icon.textContent = ingredientsVisible ? 'â–²' : 'â–¼';
}

async function toggleChefMode() {
    chefMode = !chefMode;
    const btn = document.getElementById('chefBtn');
    const cont = document.getElementById('chefModeContainer');
    
    if (chefMode) {
        btn.classList.add('chef-on');
        cont.classList.add('active');
        currentStepIndex = 0;
        updateChefMode();
        renderStepsPreview();
        updateChefIngredients();
        
        try {
            if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen');
        } catch(e) {
            enableVideoWakeLock();
        }
        
        if (recognition) {
            try { recognition.start(); } catch(e) {
                document.getElementById('voiceStatus').textContent = 'ğŸ¤ Click';
            }
        }
        speakCurrentStep();
    } else {
        btn.classList.remove('chef-on');
        cont.classList.remove('active');
        
        try {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        } catch(e) {}
        
        disableVideoWakeLock();
        if (recognition) recognition.stop();
        resetTimer();
    }
}

function updateChefMode() {
    const s = steps[currentStepIndex];
    document.getElementById('stepTitle').textContent = `Step ${currentStepIndex+1}: ${s.title}`;
    document.getElementById('stepText').textContent = s.text;
    document.getElementById('progressText').textContent = `Step ${currentStepIndex+1} of ${steps.length}`;
    document.getElementById('progressFill').style.width = `${((currentStepIndex+1)/steps.length)*100}%`;
    document.getElementById('prevBtn').disabled = currentStepIndex === 0;
    document.getElementById('nextBtn').disabled = currentStepIndex === steps.length - 1;
    
    const ts = document.getElementById('timerSection');
    ts.style.display = s.timer ? 'block' : 'none';
    
    resetTimer();
    renderStepsPreview();
}

function nextStep() {
    if (currentStepIndex < steps.length - 1) {
        currentStepIndex++;
        updateChefMode();
        speakCurrentStep();
    }
}

function prevStep() {
    if (currentStepIndex > 0) {
        currentStepIndex--;
        updateChefMode();
        speakCurrentStep();
    }
}

function renderStepsPreview() {
    const c = document.getElementById('stepsPreview');
    c.innerHTML = '';
    steps.forEach((s, i) => {
        const d = document.createElement('div');
        d.className = 'step-preview';
        if (i === currentStepIndex) d.classList.add('active');
        d.innerHTML = `<strong>Step ${i+1}:</strong> ${s.title}`;
        d.onclick = () => {
            currentStepIndex = i;
            updateChefMode();
            speakCurrentStep();
        };
        c.appendChild(d);
    });
}

function startTimer(sec) {
    resetTimer();
    timerSeconds = sec;
    timerRunning = true;
    updateTimerDisplay();
    timerInterval = setInterval(() => {
        if (timerRunning && timerSeconds > 0) {
            timerSeconds--;
            updateTimerDisplay();
            if (timerSeconds === 0) {
                timerRunning = false;
                playTimerSound();
                speak('Timer done!');
            }
        }
    }, 1000);
}

function pauseTimer() {
    timerRunning = !timerRunning;
    const pb = document.querySelector('.timer-buttons button:nth-child(4)');
    if (pb) pb.textContent = timerRunning ? 'â¸ Pause' : 'â–¶ï¸ Resume';
}

function resetTimer() {
    clearInterval(timerInterval);
    timerSeconds = 0;
    timerRunning = false;
    updateTimerDisplay();
    const pb = document.querySelector('.timer-buttons button:nth-child(4)');
    if (pb) pb.textContent = 'â¸ Pause';
}

function updateTimerDisplay() {
    const m = Math.floor(timerSeconds / 60), s = timerSeconds % 60;
    document.getElementById('timerDisplay').textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function playTimerSound() {
    try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator(), g = ctx.createGain();
        osc.connect(g);
        g.connect(ctx.destination);
        osc.frequency.value = 800;
        osc.type = 'sine';
        g.gain.setValueAtTime(0.3, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.5);
    } catch(e) {}
}

function speak(txt) {
    if ('speechSynthesis' in window && txt) {
        const u = new SpeechSynthesisUtterance(txt);
        u.rate = 0.9;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
    }
}

function speakCurrentStep() {
    const s = steps[currentStepIndex];
    speak(`Step ${currentStepIndex+1}: ${s.title}. ${s.text}`);
}

function retryVoice() {
    if (recognition && chefMode) {
        try {
            recognition.stop();
            setTimeout(() => recognition.start(), 500);
        } catch(e) {}
    }
}

function updateChefIngredients() {
    const c = document.getElementById('chefIngredientsContent');
    c.innerHTML = '';
    document.querySelectorAll('#ingredientsList .ingredient-item').forEach((it, i) => {
        const d = document.createElement('div');
        d.className = 'chef-ingredient-item';
        d.dataset.index = i;
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!it.querySelector('input').checked;
        const sp = document.createElement('span');
        sp.textContent = it.querySelector('span').textContent;
        if (it.classList.contains('checked')) d.classList.add('checked');
        d.appendChild(cb);
        d.appendChild(sp);
        d.onclick = () => toggleChefIngredient(d);
        c.appendChild(d);
    });
}

function printRecipe() {
    window.print();
}

function showFullCommandModal() {
    document.getElementById('fullCommandModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function closeFullCommandModal() {
    document.getElementById('fullCommandModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Close modal when clicking outside
document.addEventListener('click', (e) => {
    const modal = document.getElementById('fullCommandModal');
    if (e.target === modal) closeFullCommandModal();
});

document.getElementById('ingredientsList').addEventListener('change', updateChefIngredients);
</script>
</body>
</html>
